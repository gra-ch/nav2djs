var NAV2D=NAV2D||{REVISION:"0.4.0"};NAV2D.resizeMap=function(e,o,t){return e||(e={width:t.width,height:t.height,x:t.pose.position.x,y:t.pose.position.y},o.scaleToDimensions(t.width,t.height),o.shift(t.pose.position.x,t.pose.position.y)),e.width===t.width&&e.height===t.height||(o.scaleToDimensions(t.width,t.height),e.width=t.width,e.height=t.height),e.x===t.pose.position.x&&e.y===t.pose.position.y||(o.shift(t.pose.position.x-e.x,t.pose.position.y-e.y),e.x=t.pose.position.x,e.y=t.pose.position.y),e},NAV2D.ImageMapClientNav=function(e){var o=(e=e||{}).ros,t=e.tfClient||null,a=e.topic||"/map_metadata",i=e.robot_pose||"/robot_pose",n=e.image_map,s=e.image||!1,r=e.serverName||"/move_base",l=e.actionName||"move_base_msgs/MoveBaseAction",c=e.rootObject||new createjs.Container,g=e.viewer,e=e.withOrientation||!1,p=null,h=new ROS2D.ImageMapClient({ros:o,rootObject:c,topic:a,image:n});new NAV2D.Navigator({ros:o,tfClient:t,serverName:r,actionName:l,robot_pose:i,rootObject:c,withOrientation:e,image:s});h.on("change",function(){p=NAV2D.resizeMap(p,g,h.currentGrid)})},NAV2D.Navigator=function(e){var t=this,o=(e=e||{}).ros,a=e.tfClient||null,i=e.robot_pose||"/robot_pose",n=e.serverName||"/move_base",s=e.actionName||"move_base_msgs/MoveBaseAction",r=e.withOrientation||!1,l=e.image,c=(this.rootObject=e.rootObject||new createjs.Container,this.goalMarker=null,new ROSLIB.ActionClient({ros:o,actionName:s,serverName:n}));function g(e){var o=new ROSLIB.Goal({actionClient:c,goalMessage:{target_pose:{header:{frame_id:"/map"},pose:e}}});o.send(),null===t.goalMarker&&(l&&ROS2D.hasOwnProperty("ImageNavigator")?t.goalMarker=new ROS2D.ImageNavigator({size:2.5,image:l,alpha:.7,pulse:!0}):t.goalMarker=new ROS2D.NavigationArrow({size:15,strokeSize:1,fillColor:createjs.Graphics.getRGB(255,64,128,.66),pulse:!0}),t.rootObject.addChild(t.goalMarker)),t.goalMarker.x=e.position.x,t.goalMarker.y=-e.position.y,t.goalMarker.rotation=R.rosQuaternionToGlobalTheta(e.orientation),t.goalMarker.scaleX=1/R.scaleX,t.goalMarker.scaleY=1/R.scaleY,o.on("result",function(){t.rootObject.removeChild(t.goalMarker)})}function p(e,o){f.x=e.x,f.y=-e.y,M||(f.scaleX=1/R.scaleX,f.scaleY=1/R.scaleY,M=!0),f.rotation=R.rosQuaternionToGlobalTheta(o),f.visible=!0}var h,m,u,O,v,w,b,d,N,R=t.rootObject instanceof createjs.Stage?t.rootObject:t.rootObject.getStage(),f=null,M=((f=l&&ROS2D.hasOwnProperty("ImageNavigator")?new ROS2D.ImageNavigator({size:2.5,image:l,pulse:!0}):new ROS2D.NavigationArrow({size:25,strokeSize:1,fillColor:createjs.Graphics.getRGB(255,128,0,.66),pulse:!0})).visible=!1,this.rootObject.addChild(f),!1);null!==a?a.subscribe(i,function(e){p(e.translation,e.rotation)}):new ROSLIB.Topic({ros:o,name:i,messageType:"geometry_msgs/Pose",throttle_rate:100}).subscribe(function(e){p(e.position,e.orientation)}),!1===r?this.rootObject.addEventListener("dblclick",function(e){e=R.globalToRos(e.stageX,e.stageY);g(new ROSLIB.Pose({position:new ROSLIB.Vector3(e)}))}):(v=m=h=null,w=!1,d=b=O=u=0,N=function(e,o){"down"===o?(h=R.globalToRos(e.stageX,e.stageY),m=new ROSLIB.Vector3(h),w=!0):"move"===o?(t.rootObject.removeChild(v),!0===w&&(o=R.globalToRos(e.stageX,e.stageY),o=new ROSLIB.Vector3(o),v=l&&ROS2D.hasOwnProperty("ImageNavigator")?new ROS2D.ImageNavigator({size:2.5,image:l,alpha:.7,pulse:!1}):new ROS2D.NavigationArrow({size:25,strokeSize:1,fillColor:createjs.Graphics.getRGB(0,255,0,.66),pulse:!1}),b=o.x-m.x,d=o.y-m.y,u=Math.atan2(b,d),0<=(O=u*(180/Math.PI))&&O<=180?O+=270:O-=90,v.x=m.x,v.y=-m.y,v.rotation=O,v.scaleX=1/R.scaleX,v.scaleY=1/R.scaleY,t.rootObject.addChild(v))):w&&(w=!1,o=R.globalToRos(e.stageX,e.stageY),e=new ROSLIB.Vector3(o),b=e.x-m.x,d=e.y-m.y,0<=(u=Math.atan2(b,d))&&u<=Math.PI?u+=3*Math.PI/2:u-=Math.PI/2,o=Math.sin(-u/2),e=Math.cos(-u/2),o=new ROSLIB.Quaternion({x:0,y:0,z:o,w:e}),g(new ROSLIB.Pose({position:m,orientation:o})))},this.rootObject.addEventListener("stagemousedown",function(e){N(e,"down")}),this.rootObject.addEventListener("stagemousemove",function(e){N(e,"move")}),this.rootObject.addEventListener("stagemouseup",function(e){N(e,"up")}))},NAV2D.OccupancyGridClientNav=function(e){var o=(e=e||{}).ros,t=e.tfClient||null,a=e.topic||"/map",i=e.robot_pose||"/robot_pose",n=e.continuous,s=e.serverName||"/move_base",r=e.actionName||"move_base_msgs/MoveBaseAction",l=e.rootObject||new createjs.Container,c=e.viewer,g=e.withOrientation||!1,e=e.image||!1,p=null,h=new ROS2D.OccupancyGridClient({ros:o,rootObject:l,continuous:n,topic:a});new NAV2D.Navigator({ros:o,tfClient:t,serverName:s,actionName:r,robot_pose:i,rootObject:l,withOrientation:g,image:e});h.on("change",function(){p=NAV2D.resizeMap(p,c,h.currentGrid)})};